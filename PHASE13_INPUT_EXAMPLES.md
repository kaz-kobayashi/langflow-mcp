# Phase 13 動作確認用入力例

Phase 13で実装した2つの新機能の動作確認用入力例です。

---

## Phase 13-1: 動的計画法による安全在庫配置

### 入力例1: 基本的な3段階ツリー構造

```
3段階サプライチェーンネットワークで動的計画法により安全在庫配置を最適化してください。

品目データ（JSON形式）:
[
  {
    "name": "原材料",
    "h": 1.0,
    "mu": 0,
    "sigma": 0,
    "proc_time": 1,
    "lead_time_lb": 2,
    "lead_time_ub": 4
  },
  {
    "name": "中間品",
    "h": 2.0,
    "mu": 0,
    "sigma": 0,
    "proc_time": 2,
    "lead_time_lb": 1,
    "lead_time_ub": 3
  },
  {
    "name": "最終製品",
    "h": 5.0,
    "mu": 100.0,
    "sigma": 20.0,
    "proc_time": 1,
    "lead_time_lb": 1,
    "lead_time_ub": 2
  }
]

BOMデータ（JSON形式）:
[
  {"child": "原材料", "parent": "中間品", "units": 1.0},
  {"child": "中間品", "parent": "最終製品", "units": 1.0}
]

サービスレベル: 95%（z=1.65）
```

**期待される出力:**
- 総コスト: 約165.00
- 各段階の保証リードタイム（Lstar）
- 各段階の正味補充時間（NRT）
- 各段階の安全在庫レベル

---

### 入力例2: 4段階の複雑なツリー構造

```
4段階サプライチェーンで動的計画法による安全在庫配置の最適化を実行してください。

品目データ（JSON形式）:
[
  {
    "name": "原材料A",
    "h": 0.5,
    "mu": 0,
    "sigma": 0,
    "proc_time": 1,
    "lead_time_lb": 1,
    "lead_time_ub": 2
  },
  {
    "name": "原材料B",
    "h": 0.8,
    "mu": 0,
    "sigma": 0,
    "proc_time": 1,
    "lead_time_lb": 2,
    "lead_time_ub": 3
  },
  {
    "name": "中間品",
    "h": 2.0,
    "mu": 0,
    "sigma": 0,
    "proc_time": 2,
    "lead_time_lb": 1,
    "lead_time_ub": 3
  },
  {
    "name": "最終製品",
    "h": 5.0,
    "mu": 150.0,
    "sigma": 25.0,
    "proc_time": 1,
    "lead_time_lb": 1,
    "lead_time_ub": 2
  }
]

BOMデータ（JSON形式）:
[
  {"child": "原材料A", "parent": "中間品"},
  {"child": "原材料B", "parent": "中間品"},
  {"child": "中間品", "parent": "最終製品"}
]

サービスレベル: 97.5%（z=1.96）
```

**期待される出力:**
- 総コスト: 約245.00
- サービスレベル: 97.5%
- 4段階すべての保証リードタイムとNRT

---

### 入力例3: 異なるサービスレベルでの比較

```
2段階サプライチェーンで、異なるサービスレベルでの最適化を実行して比較してください。

品目データ（JSON形式）:
[
  {
    "name": "原材料",
    "h": 1.0,
    "mu": 0,
    "sigma": 0,
    "proc_time": 1,
    "lead_time_lb": 2,
    "lead_time_ub": 4
  },
  {
    "name": "最終製品",
    "h": 5.0,
    "mu": 100.0,
    "sigma": 15.0,
    "proc_time": 1,
    "lead_time_lb": 1,
    "lead_time_ub": 2
  }
]

BOMデータ（JSON形式）:
[
  {"child": "原材料", "parent": "最終製品"}
]

サービスレベル（複数実行して比較）:
- 90%: z=1.28
- 95%: z=1.65
- 97.5%: z=1.96
- 99%: z=2.33
```

**期待される結果:**
- サービスレベルが高いほど、総コストが増加
- サービスレベルが高いほど、安全在庫レベルが増加
- コストは単調増加する

---

### 入力例4: 深い階層のツリー（5段階）

```
5段階の深いツリー構造で動的計画法を実行してください。

品目データ（JSON形式）:
[
  {"name": "Stage0", "h": 0.5, "mu": 0, "sigma": 0, "proc_time": 1, "lead_time_lb": 1, "lead_time_ub": 2},
  {"name": "Stage1", "h": 1.0, "mu": 0, "sigma": 0, "proc_time": 1, "lead_time_lb": 1, "lead_time_ub": 2},
  {"name": "Stage2", "h": 2.0, "mu": 0, "sigma": 0, "proc_time": 1, "lead_time_lb": 1, "lead_time_ub": 2},
  {"name": "Stage3", "h": 3.0, "mu": 0, "sigma": 0, "proc_time": 1, "lead_time_lb": 1, "lead_time_ub": 2},
  {"name": "Stage4", "h": 5.0, "mu": 200.0, "sigma": 30.0, "proc_time": 1, "lead_time_lb": 1, "lead_time_ub": 2}
]

BOMデータ（JSON形式）:
[
  {"child": "Stage0", "parent": "Stage1"},
  {"child": "Stage1", "parent": "Stage2"},
  {"child": "Stage2", "parent": "Stage3"},
  {"child": "Stage3", "parent": "Stage4"}
]
```

**期待される出力:**
- 総コスト: 約247.50
- 5段階すべての最適な保証リードタイム

---

## Phase 13-2: 分布ベースの基在庫シミュレーション

### 入力例5: 正規分布での基在庫シミュレーション

```
正規分布の需要を持つ単一段階在庫システムで、基在庫シミュレーションを実行してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: 正規分布
  - 平均（mu）: 100
  - 標準偏差（sigma）: 10
- リードタイム: 2期
- バックオーダーコスト: 100
- 在庫保管費用: 1
```

**期待される出力:**
- 基在庫レベル（自動計算）: 約370
- 平均コスト
- 勾配（最適化に使用可能）
- 在庫統計（平均在庫、標準偏差、品切れ率）

---

### 入力例6: 一様分布（基在庫レベル指定）

```
一様分布の需要を持つシステムで、基在庫レベルを明示的に指定してシミュレーションを実行してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: 一様分布
  - 下限（low）: 80
  - 上限（high）: 120
- リードタイム: 1期
- バックオーダーコスト: 150
- 在庫保管費用: 2
- 基在庫レベル: 250（明示的に指定）
```

**期待される出力:**
- 基在庫レベル: 250.00（指定値）
- 平均コスト
- 品切れ率

---

### 入力例7: ポアソン分布（生産能力制約あり）

```
ポアソン分布の需要を持ち、生産能力制約があるシステムでシミュレーションを実行してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: ポアソン分布
  - レート（lam）: 100
- 生産能力: 200（制約あり）
- リードタイム: 2期
- バックオーダーコスト: 100
- 在庫保管費用: 1
```

**期待される出力:**
- 生産能力制約を考慮した結果
- 平均コスト
- 在庫統計

---

### 入力例8: ガンマ分布での最適化

```
ガンマ分布の需要を持つシステムでシミュレーションを実行してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: ガンマ分布
  - 形状パラメータ（shape）: 4
  - スケールパラメータ（scale）: 25
- リードタイム: 3期
```

**期待される出力:**
- 分布タイプ: gamma
- 基在庫レベル（自動計算）
- 平均コスト

---

### 入力例9: 対数正規分布

```
対数正規分布の需要を持つシステムでシミュレーションを実行してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: 対数正規分布
  - 形状パラメータ（s）: 0.3
  - スケールパラメータ（scale）: 100
- リードタイム: 2期
- バックオーダーコスト: 200
- 在庫保管費用: 3
```

**期待される出力:**
- 平均コスト
- 平均在庫レベル
- 在庫統計

---

### 入力例10: 異なるリードタイムでの比較

```
同じ需要分布で、異なるリードタイムでの基在庫シミュレーションを実行して比較してください。

パラメータ:
- サンプル数: 100
- シミュレーション期間: 150期
- 需要分布: 正規分布（mu=100, sigma=10）
- バックオーダーコスト: 100
- 在庫保管費用: 1

リードタイム（複数実行して比較）:
- 1期
- 2期
- 3期
- 5期
```

**期待される結果:**
- リードタイムが長いほど、基在庫レベルが高くなる
- リードタイムが長いほど、平均コストが増加する傾向
- 各リードタイムでの最適な基在庫レベルが自動計算される

---

## サポートされている需要分布一覧

Phase 13-2では以下の6種類の確率分布をサポートしています：

### 1. 正規分布（normal）
```json
{
  "type": "normal",
  "params": {
    "mu": 100,      // 平均
    "sigma": 10     // 標準偏差
  }
}
```

### 2. 一様分布（uniform）
```json
{
  "type": "uniform",
  "params": {
    "low": 80,      // 下限
    "high": 120     // 上限
  }
}
```

### 3. 指数分布（exponential）
```json
{
  "type": "exponential",
  "params": {
    "scale": 100    // スケールパラメータ
  }
}
```

### 4. ポアソン分布（poisson）
```json
{
  "type": "poisson",
  "params": {
    "lam": 100      // レート（平均）
  }
}
```

### 5. ガンマ分布（gamma）
```json
{
  "type": "gamma",
  "params": {
    "shape": 2,     // 形状パラメータ
    "scale": 50     // スケールパラメータ
  }
}
```

### 6. 対数正規分布（lognormal）
```json
{
  "type": "lognormal",
  "params": {
    "s": 0.5,       // 形状パラメータ
    "scale": 100    // スケールパラメータ
  }
}
```

---

## トラブルシューティング

### Phase 13-1のエラー

**エラー: "ネットワークがツリー構造ではありません"**
- 原因: ネットワークに閉路が含まれている、または複数の親を持つノードがある
- 解決策: BOMデータを確認し、各品目が1つの親のみを持つようにする

**エラー: "ネットワークに閉路が含まれています"**
- 原因: BOMデータに循環依存がある
- 解決策: BOMの依存関係を見直し、閉路を除去する

### Phase 13-2のエラー

**エラー: "サポートされていない分布タイプ"**
- 原因: 指定した分布タイプがサポートされていない
- 解決策: 上記の「サポートされている需要分布一覧」から選択する

**エラー: "demand_distが指定されていません"**
- 原因: 需要分布パラメータが未指定
- 解決策: `demand_dist`パラメータを必ず指定する

---

## パフォーマンスに関する注意事項

- **Phase 13-1**: ツリー構造の深さやリードタイム範囲が大きい場合、計算時間が増加します
  - 推奨: リードタイム範囲は10以下
  - 推奨: ツリーの深さは10段階以下

- **Phase 13-2**: サンプル数や期間が大きい場合、計算時間が増加します
  - 推奨: n_samples ≤ 200
  - 推奨: n_periods ≤ 300
  - 大規模シミュレーションの場合は段階的に実行

---

## 関連ドキュメント

- `IMPLEMENTATION_SUMMARY.md`: Phase 12実装の詳細サマリー
- `LOCAL_DEVELOPMENT.md`: ローカル開発環境のセットアップガイド
- `test_phase13_1.py`: Phase 13-1のテストコード（実装例）
- `test_phase13_2.py`: Phase 13-2のテストコード（実装例）
